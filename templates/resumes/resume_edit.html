{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Resume: {{ resume.title }}</h4>
                            <small class="opacity-80">Last updated: {{ resume.updated_at|date:"M d, Y H:i" }}</small>
                        </div>
                        <div>
                            <span class="badge bg-light text-dark fs-6">Version {{ resume.version }}</span>
                            {% if resume.is_default %}
                            <span class="badge bg-success ms-1">Default</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    {% if messages %}
                    <div class="mb-4">
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                            <i class="fas fa-{% if message.tags == 'success' %}check-circle{% else %}exclamation-triangle{% endif %} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <form method="post" id="resumeForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Navigation Tabs -->
                        <div class="sticky-top bg-white pt-3 pb-2" style="z-index: 10;">
                            <ul class="nav nav-pills mb-4" id="resumeTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="personal-tab" data-bs-toggle="pill" data-bs-target="#personal" type="button" role="tab">
                                        <i class="fas fa-user me-1 d-none d-md-inline"></i> Personal
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="education-tab" data-bs-toggle="pill" data-bs-target="#education" type="button" role="tab">
                                        <i class="fas fa-graduation-cap me-1 d-none d-md-inline"></i> Education
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="experience-tab" data-bs-toggle="pill" data-bs-target="#experience" type="button" role="tab">
                                        <i class="fas fa-briefcase me-1 d-none d-md-inline"></i> Experience
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="skills-tab" data-bs-toggle="pill" data-bs-target="#skills" type="button" role="tab">
                                        <i class="fas fa-tools me-1 d-none d-md-inline"></i> Skills
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="projects-tab" data-bs-toggle="pill" data-bs-target="#projects" type="button" role="tab">
                                        <i class="fas fa-project-diagram me-1 d-none d-md-inline"></i> Projects
                                    </button>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="tab-content" id="resumeTabsContent">
                            <!-- Personal Details Section -->
                            <div class="tab-pane fade show active" id="personal" role="tabpanel">
                                <div class="card mb-4 border-primary">
                                    <div class="card-header bg-light-primary text-dark">
                                        <h5 class="mb-0"><i class="fas fa-user me-2"></i>Personal Details</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    {{ personal_details_form.full_name }}
                                                    <label for="{{ personal_details_form.full_name.id_for_label }}">Full Name *</label>
                                                    {% if personal_details_form.full_name.errors %}
                                                    <div class="invalid-feedback d-block">
                                                        {{ personal_details_form.full_name.errors }}
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    {{ personal_details_form.email }}
                                                    <label for="{{ personal_details_form.email.id_for_label }}">Email *</label>
                                                    {% if personal_details_form.email.errors %}
                                                    <div class="invalid-feedback d-block">
                                                        {{ personal_details_form.email.errors }}
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    {{ personal_details_form.phone }}
                                                    <label for="{{ personal_details_form.phone.id_for_label }}">Phone</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    {{ personal_details_form.address }}
                                                    <label for="{{ personal_details_form.address.id_for_label }}">Address</label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    {{ personal_details_form.linkedin }}
                                                    <label for="{{ personal_details_form.linkedin.id_for_label }}">LinkedIn URL</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    {{ personal_details_form.website }}
                                                    <label for="{{ personal_details_form.website.id_for_label }}">Website URL</label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-floating mb-3">
                                            {{ personal_details_form.summary }}
                                            <label for="{{ personal_details_form.summary.id_for_label }}">Professional Summary</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Education Section -->
                            <div class="tab-pane fade" id="education" role="tabpanel">
                                <div class="card mb-4 border-success">
                                    <div class="card-header bg-light-success text-dark d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i>Education</h5>
                                        <button type="button" class="btn btn-sm btn-success" id="add-education-btn">
                                            <i class="fas fa-plus me-1"></i> Add Education
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        {{ education_formset.management_form }}
                                        <div id="education-form-container">
                                            {% for form in education_formset %}
                                            <div class="education-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.institution }}
                                                            <label for="{{ form.institution.id_for_label }}">Institution *</label>
                                                            {% if form.institution.errors %}
                                                            <div class="invalid-feedback d-block">
                                                                {{ form.institution.errors }}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.degree }}
                                                            <label for="{{ form.degree.id_for_label }}">Degree *</label>
                                                            {% if form.degree.errors %}
                                                            <div class="invalid-feedback d-block">
                                                                {{ form.degree.errors }}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.field_of_study }}
                                                            <label for="{{ form.field_of_study.id_for_label }}">Field of Study</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            {{ form.start_date }}
                                                            <label for="{{ form.start_date.id_for_label }}">Start Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            {{ form.end_date }}
                                                            <label for="{{ form.end_date.id_for_label }}">End Date</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    {{ form.description }}
                                                    <label for="{{ form.description.id_for_label }}">Description</label>
                                                </div>
                                                <div class="form-check mb-3">
                                                    {{ form.current }}
                                                    <label class="form-check-label" for="{{ form.current.id_for_label }}">
                                                        I am currently studying here
                                                    </label>
                                                </div>
                                                {{ form.DELETE|default:"" }}
                                                {{ form.id }}
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <template id="empty-education-form">
                                            <div class="education-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="education-__prefix__-institution" class="form-control" id="id_education-__prefix__-institution" required placeholder="Enter institution name">
                                                            <label for="id_education-__prefix__-institution">Institution *</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="education-__prefix__-degree" class="form-control" id="id_education-__prefix__-degree" required placeholder="Enter degree">
                                                            <label for="id_education-__prefix__-degree">Degree *</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="education-__prefix__-field_of_study" class="form-control" id="id_education-__prefix__-field_of_study" placeholder="Enter field of study">
                                                            <label for="id_education-__prefix__-field_of_study">Field of Study</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            <input type="date" name="education-__prefix__-start_date" class="form-control" id="id_education-__prefix__-start_date">
                                                            <label for="id_education-__prefix__-start_date">Start Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            <input type="date" name="education-__prefix__-end_date" class="form-control" id="id_education-__prefix__-end_date">
                                                            <label for="id_education-__prefix__-end_date">End Date</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    <textarea name="education-__prefix__-description" class="form-control" id="id_education-__prefix__-description" rows="3" placeholder="Enter description of your studies"></textarea>
                                                    <label for="id_education-__prefix__-description">Description</label>
                                                </div>
                                                <div class="form-check mb-3">
                                                    <input type="checkbox" name="education-__prefix__-current" class="form-check-input" id="id_education-__prefix__-current">
                                                    <label class="form-check-label" for="id_education-__prefix__-current">
                                                        I am currently studying here
                                                    </label>
                                                </div>
                                                <input type="hidden" name="education-__prefix__-DELETE" id="id_education-__prefix__-DELETE">
                                                <input type="hidden" name="education-__prefix__-id" id="id_education-__prefix__-id">
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Experience Section -->
                            <div class="tab-pane fade" id="experience" role="tabpanel">
                                <div class="card mb-4 border-info">
                                    <div class="card-header bg-light-info text-dark d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Experience</h5>
                                        <button type="button" class="btn btn-sm btn-info" id="add-experience-btn">
                                            <i class="fas fa-plus me-1"></i> Add Experience
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        {{ experience_formset.management_form }}
                                        <div id="experience-form-container">
                                            {% for form in experience_formset %}
                                            <div class="experience-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.company }}
                                                            <label for="{{ form.company.id_for_label }}">Company *</label>
                                                            {% if form.company.errors %}
                                                            <div class="invalid-feedback d-block">
                                                                {{ form.company.errors }}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.position }}
                                                            <label for="{{ form.position.id_for_label }}">Position *</label>
                                                            {% if form.position.errors %}
                                                            <div class="invalid-feedback d-block">
                                                                {{ form.position.errors }}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            {{ form.start_date }}
                                                            <label for="{{ form.start_date.id_for_label }}">Start Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            {{ form.end_date }}
                                                            <label for="{{ form.end_date.id_for_label }}">End Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-check mb-3 mt-4">
                                                            {{ form.current }}
                                                            <label class="form-check-label" for="{{ form.current.id_for_label }}">
                                                                I currently work here
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    {{ form.description }}
                                                    <label for="{{ form.description.id_for_label }}">Description</label>
                                                </div>
                                                {{ form.DELETE|default:"" }}
                                                {{ form.id }}
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <template id="empty-experience-form">
                                            <div class="experience-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="experience-__prefix__-company" class="form-control" id="id_experience-__prefix__-company" required placeholder="Enter company name">
                                                            <label for="id_experience-__prefix__-company">Company *</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="experience-__prefix__-position" class="form-control" id="id_experience-__prefix__-position" required placeholder="Enter position title">
                                                            <label for="id_experience-__prefix__-position">Position *</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            <input type="date" name="experience-__prefix__-start_date" class="form-control" id="id_experience-__prefix__-start_date">
                                                            <label for="id_experience-__prefix__-start_date">Start Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            <input type="date" name="experience-__prefix__-end_date" class="form-control" id="id_experience-__prefix__-end_date">
                                                            <label for="id_experience-__prefix__-end_date">End Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-check mb-3 mt-4">
                                                            <input type="checkbox" name="experience-__prefix__-current" class="form-check-input" id="id_experience-__prefix__-current">
                                                            <label class="form-check-label" for="id_experience-__prefix__-current">
                                                                I currently work here
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    <textarea name="experience-__prefix__-description" class="form-control" id="id_experience-__prefix__-description" rows="3" placeholder="Describe your responsibilities and achievements"></textarea>
                                                    <label for="id_experience-__prefix__-description">Description</label>
                                                </div>
                                                <input type="hidden" name="experience-__prefix__-DELETE" id="id_experience-__prefix__-DELETE">
                                                <input type="hidden" name="experience-__prefix__-id" id="id_experience-__prefix__-id">
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Skills Section -->
                            <div class="tab-pane fade" id="skills" role="tabpanel">
                                <div class="card mb-4 border-warning">
                                    <div class="card-header bg-light-warning text-dark d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-tools me-2"></i>Skills</h5>
                                        <button type="button" class="btn btn-sm btn-warning" id="add-skill-btn">
                                            <i class="fas fa-plus me-1"></i> Add Skill
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        {{ skill_formset.management_form }}
                                        <div id="skill-form-container">
                                            {% for form in skill_formset %}
                                            <div class="skill-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.name }}
                                                            <label for="{{ form.name.id_for_label }}">Skill Name *</label>
                                                            {% if form.name.errors %}
                                                            <div class="invalid-feedback d-block">
                                                                {{ form.name.errors }}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.level }}
                                                            <label for="{{ form.level.id_for_label }}">Skill Level</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                {{ form.DELETE|default:"" }}
                                                {{ form.id }}
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <template id="empty-skill-form">
                                            <div class="skill-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="skills-__prefix__-name" class="form-control" id="id_skills-__prefix__-name" required placeholder="Enter skill name">
                                                            <label for="id_skills-__prefix__-name">Skill Name *</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <select name="skills-__prefix__-level" class="form-select" id="id_skills-__prefix__-level">
                                                                <option value="">Select level</option>
                                                                <option value="beginner">Beginner</option>
                                                                <option value="intermediate">Intermediate</option>
                                                                <option value="advanced">Advanced</option>
                                                                <option value="expert">Expert</option>
                                                            </select>
                                                            <label for="id_skills-__prefix__-level">Skill Level</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <input type="hidden" name="skills-__prefix__-DELETE" id="id_skills-__prefix__-DELETE">
                                                <input type="hidden" name="skills-__prefix__-id" id="id_skills-__prefix__-id">
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Projects Section -->
                            <div class="tab-pane fade" id="projects" role="tabpanel">
                                <div class="card mb-4 border-purple">
                                    <div class="card-header bg-light-purple text-dark d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Projects</h5>
                                        <button type="button" class="btn btn-sm btn-purple" id="add-project-btn">
                                            <i class="fas fa-plus me-1"></i> Add Project
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        {{ project_formset.management_form }}
                                        <div id="project-form-container">
                                            {% for form in project_formset %}
                                            <div class="project-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.name }}
                                                            <label for="{{ form.name.id_for_label }}">Project Name *</label>
                                                            {% if form.name.errors %}
                                                            <div class="invalid-feedback d-block">
                                                                {{ form.name.errors }}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            {{ form.url }}
                                                            <label for="{{ form.url.id_for_label }}">Project URL</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            {{ form.start_date }}
                                                            <label for="{{ form.start_date.id_for_label }}">Start Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            {{ form.end_date }}
                                                            <label for="{{ form.end_date.id_for_label }}">End Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6"></div>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    {{ form.description }}
                                                    <label for="{{ form.description.id_for_label }}">Description</label>
                                                </div>
                                                {{ form.DELETE|default:"" }}
                                                {{ form.id }}
                                            </div>
                                            {% endfor %}
                                        </div>
                                        <template id="empty-project-form">
                                            <div class="project-form mb-3 p-3 border rounded position-relative">
                                                <div class="position-absolute top-0 end-0 mt-2 me-2">
                                                    <button type="button" class="btn btn-sm btn-danger remove-form">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="text" name="projects-__prefix__-name" class="form-control" id="id_projects-__prefix__-name" required placeholder="Enter project name">
                                                            <label for="id_projects-__prefix__-name">Project Name *</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <input type="url" name="projects-__prefix__-url" class="form-control" id="id_projects-__prefix__-url" placeholder="https://example.com">
                                                            <label for="id_projects-__prefix__-url">Project URL</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            <input type="date" name="projects-__prefix__-start_date" class="form-control" id="id_projects-__prefix__-start_date">
                                                            <label for="id_projects-__prefix__-start_date">Start Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="form-floating mb-3">
                                                            <input type="date" name="projects-__prefix__-end_date" class="form-control" id="id_projects-__prefix__-end_date">
                                                            <label for="id_projects-__prefix__-end_date">End Date</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6"></div>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    <textarea name="projects-__prefix__-description" class="form-control" id="id_projects-__prefix__-description" rows="3" placeholder="Describe the project and your role"></textarea>
                                                    <label for="id_projects-__prefix__-description">Description</label>
                                                </div>
                                                <input type="hidden" name="projects-__prefix__-DELETE" id="id_projects-__prefix__-DELETE">
                                                <input type="hidden" name="projects-__prefix__-id" id="id_projects-__prefix__-id">
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4 pt-3 border-top flex-column flex-md-row">
                            <div class="mb-3 mb-md-0">
                                <a href="{% url 'resumes:resume_list' %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>Back to List
                                </a>
                                <a href="{% url 'resumes:resume_detail' resume.id %}" class="btn btn-info ms-0 ms-md-2 mt-2 mt-md-0" target="_blank">
                                    <i class="fas fa-eye me-2"></i>Preview
                                </a>
                                <a href="{% url 'resumes:resume_pdf' resume.id %}" class="btn btn-success ms-0 ms-md-2 mt-2 mt-md-0">
                                    <i class="fas fa-download me-2"></i>Download PDF
                                </a>
                            </div>
                            <div class="d-flex flex-column flex-md-row">
                                <button type="submit" name="save_as_new" value="true" class="btn btn-warning me-0 me-md-2 mb-2 mb-md-0">
                                    <i class="fas fa-copy me-2"></i>Save as New Version
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Changes
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
        --light-primary: #e8f2ff;
        --light-success: #e9f7ef;
        --light-info: #e8f4fd;
        --light-warning: #fff5e6;
        --light-purple: #f0e6ff;
        --purple: #6f42c1;
    }
    
    .bg-gradient-primary {
        background: var(--primary-gradient) !important;
    }
    
    .bg-light-primary { background-color: var(--light-primary); }
    .bg-light-success { background-color: var(--light-success); }
    .bg-light-info { background-color: var(--light-info); }
    .bg-light-warning { background-color: var(--light-warning); }
    .bg-light-purple { background-color: var(--light-purple); }
    
    .border-purple { border-color: var(--purple) !important; }
    .btn-purple {
        background-color: var(--purple);
        border-color: var(--purple);
        color: white;
    }
    .btn-purple:hover {
        background-color: #5a359c;
        border-color: #5a359c;
        color: white;
    }
    
    .nav-pills .nav-link.active {
        background-color: #0d6efd;
        color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    
    .nav-pills .nav-link {
        color: #6c757d;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        transition: all 0.2s ease;
    }
    
    .nav-pills .nav-link:hover {
        background-color: #f8f9fa;
    }
    
    .form-floating > .form-control:focus,
    .form-floating > .form-control:not(:placeholder-shown) {
        padding-top: 1.625rem;
        padding-bottom: 0.625rem;
    }
    
    .form-floating > .form-control::placeholder {
        color: transparent;
    }
    
    .form-floating > .form-control:not(:placeholder-shown) ~ label {
        opacity: 0.65;
        transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
    }
    
    .form-floating > label {
        padding: 1rem 0.75rem;
        color: #6c757d;
        transition: all 0.1s ease-in-out;
    }
    
    .form-control:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    .btn {
        border-radius: 0.5rem;
        padding: 0.5rem 1.25rem;
        font-weight: 500;
        transition: all 0.2s ease-in-out;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }
    
    .card {
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.2s ease;
    }
    
    .card:hover {
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
        border-top-left-radius: 0.75rem !important;
        border-top-right-radius: 0.75rem !important;
    }
    
    .education-form, .experience-form, .skill-form, .project-form {
        transition: all 0.3s ease;
        background-color: #fafafa;
    }
    
    .education-form:hover, .experience-form:hover, .skill-form:hover, .project-form:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transform: translateY(-2px);
        background-color: white;
    }
    
    /* Style for remove buttons */
    .remove-form {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .card-header .d-flex {
            flex-direction: column;
            align-items: flex-start !important;
        }
        
        .card-header .btn {
            margin-top: 1rem;
            align-self: flex-end;
        }
        
        .sticky-top {
            position: relative !important;
        }
        
        .nav-pills {
            overflow-x: auto;
            white-space: nowrap;
            flex-wrap: nowrap;
            padding-bottom: 0.5rem;
        }
        
        .nav-item {
            display: inline-block;
            float: none;
        }
        
        .form-floating > label {
            font-size: 14px;
        }
    }
    
    /* Animation for form sections */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .education-form, .experience-form, .skill-form, .project-form {
        animation: fadeIn 0.3s ease-out;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enable Bootstrap form validation
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                
                // Find the first tab with errors and show it
                const invalidFields = form.querySelectorAll(':invalid');
                if (invalidFields.length > 0) {
                    const firstInvalid = invalidFields[0];
                    const tabPane = firstInvalid.closest('.tab-pane');
                    if (tabPane && !tabPane.classList.contains('active')) {
                        const tabId = tabPane.id;
                        const tabButton = document.querySelector(`[data-bs-target="#${tabId}"]`);
                        if (tabButton) {
                            new bootstrap.Tab(tabButton).show();
                        }
                    }
                    
                    // Scroll to the first error
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
            }
            form.classList.add('was-validated');
        }, false);
    });
    
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Function to handle formset forms
    function setupFormset(addButtonId, formContainerId, formPrefix, emptyFormTemplateId) {
        const addButton = document.getElementById(addButtonId);
        const formContainer = document.getElementById(formContainerId);
        const totalForms = document.getElementById(`id_${formPrefix}-TOTAL_FORMS`);
        const emptyFormTemplate = document.getElementById(emptyFormTemplateId);
        
        if (!emptyFormTemplate) {
            console.error(`Template ${emptyFormTemplateId} not found`);
            return;
        }
        
        let formCount = parseInt(totalForms.value);
        
        addButton.addEventListener('click', function() {
            const newFormHtml = emptyFormTemplate.innerHTML.replace(/__prefix__/g, formCount);
            const newFormElement = document.createElement('div');
            newFormElement.innerHTML = newFormHtml;
            newFormElement.classList.add(`${formPrefix}-form`, 'mb-3', 'p-3', 'border', 'rounded', 'position-relative');
            
            formContainer.appendChild(newFormElement);
            
            // Update form count
            formCount++;
            totalForms.value = formCount;
            
            // Initialize Bootstrap components for new form
            const floatingEls = newFormElement.querySelectorAll('.form-floating');
            floatingEls.forEach(function(el) {
                bootstrap.FormControl.getOrCreateInstance(el);
            });
            
            // Add event listener for current checkbox
            const currentCheckbox = newFormElement.querySelector('input[type="checkbox"][name$="-current"]');
            if (currentCheckbox) {
                currentCheckbox.addEventListener('change', toggleEndDateDisabled);
                // Trigger initial state
                toggleEndDateDisabled.call(currentCheckbox);
            }
        });
        
        // Remove form
        formContainer.addEventListener('click', function(e) {
            if (e.target.closest('.remove-form')) {
                const button = e.target.closest('.remove-form');
                const form = button.closest(`.${formPrefix}-form`);
                
                // Check if this is an existing record
                const deleteCheckbox = form.querySelector('input[type="hidden"][name$="-DELETE"]');
                const idField = form.querySelector('input[type="hidden"][name$="-id"]');
                
                if (idField && idField.value) {
                    // Existing record - mark for deletion
                    deleteCheckbox.value = 'on';
                    form.style.display = 'none';
                } else {
                    // New form - remove completely
                    form.remove();
                    formCount--;
                    totalForms.value = formCount;
                }
            }
        });
        
        // Initialize current checkboxes for existing forms
        formContainer.querySelectorAll('input[type="checkbox"][name$="-current"]').forEach(checkbox => {
            checkbox.addEventListener('change', toggleEndDateDisabled);
            // Trigger initial state
            toggleEndDateDisabled.call(checkbox);
        });
    }
    
    // Toggle end date disabled state based on current checkbox
    function toggleEndDateDisabled() {
        const form = this.closest('.education-form, .experience-form');
        if (!form) return;
        
        const endDateField = form.querySelector('input[type="date"][name$="-end_date"]');
        if (endDateField) {
            if (this.checked) {
                endDateField.disabled = true;
                endDateField.value = '';
            } else {
                endDateField.disabled = false;
            }
        }
    }
    
    // Set up all formsets
    setupFormset('add-education-btn', 'education-form-container', 'education', 'empty-education-form');
    setupFormset('add-experience-btn', 'experience-form-container', 'experience', 'empty-experience-form');
    setupFormset('add-skill-btn', 'skill-form-container', 'skills', 'empty-skill-form');
    setupFormset('add-project-btn', 'project-form-container', 'projects', 'empty-project-form');
    
    // Form dirty state tracking
    let formIsDirty = false;
    const form = document.getElementById('resumeForm');
    
    form.addEventListener('change', function() {
        formIsDirty = true;
    });
    
    window.addEventListener('beforeunload', function(e) {
        if (formIsDirty) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
    
    // Make tabs sticky on scroll
    window.addEventListener('scroll', function() {
        const tabs = document.querySelector('.sticky-top');
        if (tabs && window.scrollY > 100) {
            tabs.classList.add('shadow-sm', 'bg-white');
        } else if (tabs) {
            tabs.classList.remove('shadow-sm', 'bg-white');
        }
    });
    
    // Add smooth scrolling for tab navigation
    document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function() {
            window.scrollTo({
                top: document.querySelector('.sticky-top').offsetTop - 20,
                behavior: 'smooth'
            });
        });
    });
});
</script>
{% endblock %}